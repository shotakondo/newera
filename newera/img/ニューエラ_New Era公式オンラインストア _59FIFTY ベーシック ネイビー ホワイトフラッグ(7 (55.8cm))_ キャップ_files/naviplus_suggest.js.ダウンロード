/**
 *
 * The MIT License (MIT)
 * store.js - Copyright (c) 2010-2017 Marcus Westin
 *
*/
NPSuggest={};NPSuggest.currentIndex=0;NPSuggest.currentKeyword="";NPSuggest.currentRecommendList=null;NPSuggest.currentRequest=null;NPSuggest.currentColumn=null;NPSuggest.requests=[];NPSuggest.Request=function(options,sources,columns,version){this.requestIndex=NPSuggest.requests.length;this.search=new NPSuggest.SearchRequest(options,sources,columns,this.requestIndex,version);this.send_suggest_request_flag=true;this.overlay_multi_flag=false;if(this.requestIndex!=0){for(var i=0;i<this.requestIndex;i++){if(NPSuggest.requests[i].search.options.inputAreaID==options.inputAreaID){NPSuggest.requests[i].send_suggest_request_flag=false}else{this.overlay_multi_flag=true}}}NPSuggest.requests.push(this)};NPSuggest.SearchRequest=function(options,sources,columns,requestIndex,version){this.options=options;this.sources=sources;this.columns=columns;this.requestIndex=requestIndex;this.version=version;this._lastRequestInput=null;this._lastRequestCategory="";this._lastRequestField="";this._suggestKeywordList=[];this._suggestItemList=[];this._rankingRequestSendFlag=false;this._rankingData=null};NPSuggest.SearchRequest.prototype={sendRequest:function(action,params){var server=this.sources.search.server;if(server==null||server.length==0){server=window.location.host}var url="//"+server+"/~"+encodeURIComponent(this.sources.search.accountID)+"/";var query="";for(var key in params){if(typeof params[key]!="function")query+="&"+key+"="+encodeURIComponent(params[key])}url+="?action="+encodeURIComponent(action)+query;var uid=NPSuggest.Util.fetchUid();url+="&k_uid="+uid;var request=new XMLHttpRequest;request.imeout=10;request.open("POST",url,false);request.send()},_getSendScript:function(action,params,callback){var server=this.sources.search.server;if(server==null||server.length==0){server=window.location.host}var root=(document.location.protocol=="https:"?"https://":"http://")+server+"/~"+encodeURIComponent(this.sources.search.accountID)+"/";var script=document.createElement("script");script.setAttribute("type","text/javascript");script.setAttribute("language","JavaScript");script.setAttribute("charset","UTF-8");var query="";for(var key in params){if(typeof params[key]!="function")query+="&"+key+"="+encodeURIComponent(params[key])}var scriptSrc=root+"?action="+encodeURIComponent(action)+query+"&dummy="+String((new Date).getTime());if(callback!=null){scriptSrc=scriptSrc+"&callback="+encodeURIComponent(callback)}if(this.options._DUMMY_navi_command>0&&action=="suggest"){scriptSrc=scriptSrc+"&_DUMMY_navi_command="+encodeURIComponent(this.options._DUMMY_navi_command)}var uid=NPSuggest.Util.fetchUid();scriptSrc=scriptSrc+"&k_uid="+uid;script.setAttribute("src",scriptSrc);script.onload=script.onreadystatechange=null;return script},createSuggestItemList:function(keyword,categoryName,category,fieldName,callback,position){if(typeof callback=="undefined")callback=null;var column=null;var itemid_html=false;if(fieldName=="itemid_html"){if(NPSuggest.currentColumn){column=NPSuggest.currentColumn}itemid_html=true}else if(typeof this.columns[fieldName]!="undefined"){column=this.columns[fieldName]}var kc=keyword+"::"+category+"::"+fieldName;if(typeof this._suggestItemList[kc]=="undefined"){this._suggestItemList[keyword+"::"+category]={result:{items:{item:[]}}};var q=[];if(typeof column!="undefined"&&column!=null){if(position=="lower"&&typeof column.lowerSort!="undefined"){q["sort"]=column.lowerSort}else if(typeof column.upperSort!="undefined"){q["sort"]=column.upperSort}else{q["sort"]=this.options.recommendItemSort}if(this.version==2){q["fmt"]="html";if(typeof column.upperGsort!="undefined"){q["gsort"]=column.upperGsort}if(typeof column.upperGlimit!="undefined"){q["glimit"]=column.upperGlimit}if(position=="lower"){q["with_hitnum"]=1;if(typeof column.lowerTmpl!="undefined"){q["tmpl"]=column.lowerTmpl}}else{q["with_first_itemid"]=1;if(typeof column.upperTmpl!="undefined"){q["tmpl"]=column.upperTmpl}}}else{q["fmt"]="jsonp"}q["fieldName"]=fieldName;if(itemid_html){q["fieldName"]="itemid"}}else{q["sort"]=this.options.recommendItemSort;q["fmt"]="jsonp";q["fieldName"]=fieldName}if(categoryName!="undefined"&&categoryName.length>0&&category.length>0){q[categoryName]=category}if(fieldName!="undefined"&&fieldName.length>0){if(fieldName=="title"){q["t"]=keyword}else if(fieldName=="path"){q["path"]=keyword}else if(fieldName.search(/keyword/)==0){q[fieldName.replace("keyword","k")]=keyword}else if(fieldName.search(/narrow/)==0){q[fieldName.replace("narrow","s")]=keyword}else if(fieldName=="itemid"||fieldName=="itemid_html"){q["tm"]=keyword}else{q["q"]=NPSuggest.Util.normalizeKeyword(keyword)}}else{q["q"]=NPSuggest.Util.normalizeKeyword(keyword)}q["fieldValue"]=keyword;kc=kc.replace("\\","\\\\").replace('"','\\"');var script=this._getSendScript("suggestitem",q,"NPSuggest.requests["+this.requestIndex+'].search._suggestItemList["'+kc+'"]=');document.getElementsByTagName("head")[0].appendChild(script);script.onload=callback;script.onreadystatechange=function(){if(this.readyState=="loaded"||this.readyState=="complete"){callback.call()}}}else{if(callback!=null)callback.call()}},getSuggestItemList:function(keyword,category,fieldName,type){var kc=keyword+"::"+category+"::"+fieldName;if(typeof this._suggestItemList[kc]=="undefined"){return null}if(type=="html"){return this._suggestItemList[kc]}else{return this._suggestItemList[kc].kotohaco.result.items}},getSuggestItemInfo:function(keyword,category,fieldName){var kc=keyword+"::"+category+"::"+fieldName;if(typeof this._suggestItemList[kc]=="undefined"){return null}return this._suggestItemList[kc].kotohaco.result.info},clearHistoryAndRankingData:function(text){this._rankingRequestSendFlag=false;this._rankingData=null;delete this._suggestKeywordList[text]},createHistoryAndRankingData:function(ranking_data){if(this.options.historyEnabled=="on"&&this.options.rankingEnabled=="on"){var text="###his_rank"}else if(this.options.rankingEnabled=="on"){var text="###rank"}this._suggestKeywordList[text]={result:{info:{status:"0",group_by_field:"true"},keywords:[]}};var his_count=0;if(text=="###his_rank"){var history_key="__sna_h1story_"+this.options.accountID;var his=NPSuggest.Util.compatibleStoreGetDecoded(history_key);if(his){var arr_his=his.split("__");his_count=arr_his.length;for(var i=0;i<his_count;i++){this._suggestKeywordList[text].result.keywords[i]={surface:arr_his[i],kana:arr_his[i],field:"history"}}}else{this._suggestKeywordList[text]={result:{info:{status:"0",group_by_field:"true"},keywords:[]}}}}this._rankingData=ranking_data;var tmp=JSON.parse(JSON.stringify(ranking_data));if(tmp["kotohaco"]["ranking"]!==null){for(var i=0;i<tmp["kotohaco"]["ranking"].length;i++){var ranking=tmp["kotohaco"]["ranking"][i];if(ranking&&ranking.words&&ranking.words.length>0){var response_data=ranking.words;break}}}if(response_data){var limit=Math.min(response_data.length,this.options.maxSuggest);for(var i=0;i<limit;i++){if(response_data[i]){var triple={surface:response_data[i]["word"],kana:response_data[i]["word"],field:"ranking"};this._suggestKeywordList[text].result.keywords[his_count+i]=triple}}}},createSuggestKeywordList:function(text,category,field,callback){if(typeof callback=="undefined")callback=null;if(text==="######"){this._suggestKeywordList[text]={result:{info:{hitnum:20},keywords:[]}};for(var i=0;i<20;i++){this._suggestKeywordList[text].result.keywords[i]={surface:"######"+String(i+1),index:"######"+String(i+1)}}this._lastRequestInput=text;this._lastRequestCategory=category;this._lastRequestField=field;if(callback!=null)callback.call();return}if(text=="###his"&&this.options.historyEnabled=="on"){var history_key="__sna_h1story_"+this.options.accountID;var his=NPSuggest.Util.compatibleStoreGetDecoded(history_key);this._suggestKeywordList[text]={result:{info:{status:"0",group_by_field:"true"},keywords:[]}};if(his){var arr_his=his.split("__");for(var i=0;i<arr_his.length;i++){this._suggestKeywordList[text].result.keywords[i]={surface:arr_his[i],kana:arr_his[i],field:"history"}}}this._lastRequestInput=text;this._lastRequestCategory=category;this._lastRequestField=field;if(callback!=null)callback.call();return}if((text=="###his_rank"||text=="###rank")&&this.options.rankingEnabled=="on"){if(this._rankingRequestSendFlag){if(this._rankingData!=null){NPSuggest.requests[this.requestIndex].search.createHistoryAndRankingData(this._rankingData)}if(callback!=null)callback.call();return}else{var params={type:this.options.rankingType,category:category};if(this.options.rankingType=="daily"&&!params["loop"]){params["loop"]=2}var callbackRanking="NPSuggest.requests["+this.requestIndex+"].search.createHistoryAndRankingData";var script=this._getSendScript("ranking",params,callbackRanking);document.getElementsByTagName("head")[0].appendChild(script);this._rankingRequestSendFlag=true;this._lastRequestInput=text;this._lastRequestCategory=category;this._lastRequestField=field;if(callback!=null)callback.call();return}}var isSuggest=true;text2=text.replace(/^[\u0000-\u001F\s]+/g,"");if(text2.length==1&&text2.match("[㐀-䶿一-鿿豈-﫿]|[�-�][�-�]")){isSuggest=true}else if(this.options.minimumChar>0){if(text2.length>=this.options.minimumChar){isSuggest=true}else{isSuggest=false}}else{if(text2.match(/^[0-9\uFF10-\uFF19]+$/)){if(text2.length>=3){isSuggest=true}else{isSuggest=false}}else{if(text2.length>=2){isSuggest=true}else{isSuggest=false}}}if(isSuggest==false||NPSuggest.requests[this.requestIndex].send_suggest_request_flag==false){this._suggestKeywordList=[];this._lastRequestInput=null;this._lastRequestCategory="";this._lastRequestField="";if(callback!=null)callback.call();return}if(this._lastRequestCategory===category&&this._lastRequestField===field&&this._lastRequestInput!=null&&text in this._suggestKeywordList&&this._suggestKeywordList[text].result.keywords&&this._suggestKeywordList[text].result.keywords.length<250&&!(this._lastRequestInput.length==1&&this._lastRequestInput.match("[぀-ゟ]|[゠-ヿ]|[a-zA-Zａ-ｚＡ-Ｚ]"))){if(callback!=null)callback.call()}else{this._suggestKeywordList[text]={result:{info:{hitnum:0},keywords:[]}};var text2=text.replace("\\","\\\\").replace('"','\\"');var params={keyword:text,category:category,field:field,match_mode:this.options.matchMode,sort:this.options.sortType,furigana:this.options.furigana};var callbackCode="NPSuggest.requests["+this.requestIndex+'].search._suggestKeywordList["'+text2+'"]=';var script=this._getSendScript("suggest",params,callbackCode);document.getElementsByTagName("head")[0].appendChild(script);script.onload=script.onreadystatechange=callback;this._lastRequestInput=text;this._lastRequestCategory=category;this._lastRequestField=field}},getCandidateKeywordList:function(text){if(this._suggestKeywordList==null){return[]}else if(text in this._suggestKeywordList){return this._suggestKeywordList[text].result.keywords}else{return[]}},getResultInfo:function(text){if(this._suggestKeywordList==null){return[]}else if(text in this._suggestKeywordList){return this._suggestKeywordList[text].result.info}else{return[]}},createRecommendItemList:function(reco_server,account,keyword,column,callback){if(typeof callback=="undefined")callback=null;var kc=keyword+"::::recommend";if(typeof this._suggestItemList[kc]=="undefined"){this._suggestItemList[keyword]={result:{items:{item:[]}}};var k=NPSuggest.Util.normalizeKeyword(keyword);var q=[];NPSuggest.currentIndex=this.requestIndex;NPSuggest.currentKeyword=k;q["server"]=reco_server;q["k"]=account;q["q"]=keyword;if(typeof column!="undefined"&&typeof column.recommendBase!="undefined"){if(typeof column.recommendTmpl!="undefined"){q["recotmpl"]=column.recommendTmpl}var api=column.recommendBase;q["type"]=api;q["fmt"]="html";q["with_hitnum"]=1;if(typeof column.lowerTmpl!="undefined"){q["tmpl"]=column.lowerTmpl}}kc=kc.replace("\\","\\\\").replace('"','\\"');var script=this._getSendScript("recommend",q,"NPSuggest.requests["+this.requestIndex+'].search._suggestItemList["'+kc+'"]=');document.getElementsByTagName("head")[0].appendChild(script);script.onload=callback;script.onreadystatechange=function(){if(this.readyState=="loaded"||this.readyState=="complete"){callback.call()}}}else{if(callback!=null)callback.call()}}};NPSuggest.Event={add:window.addEventListener?function(element,type,func){element.addEventListener(type,func,false)}:function(element,type,func){element.attachEvent("on"+type,func)},stop:function(event){if(event.preventDefault){event.preventDefault();event.stopPropagation()}else{event.returnValue=false;event.cancelBubble=true}},getElement:function(event){return event.target||event.srcElement},getCurrentElement:function(event){return event.currentTarget||event.srcElement}};NPSuggest.Timer=function(){};NPSuggest.Timer.prototype={timerId:null,set:function(func,msec){if(this.timerId)clearTimeout(this.timerId);this.timerId=null;this.timerId=setTimeout(func,msec)},clear:function(){if(this.timerId)clearTimeout(this.timerId);this.timerId=null},hasTask:function(){if(this.timerId)return true;else return false}};NPSuggest.Controller=function(){this.initialize.apply(this,arguments);var options=arguments[0];if(options.beacon){NPSuggest.setupBeacon(options.server,options.accountID)}};NPSuggest.Controller.prototype={interval:300,defaultOptions:{server:"",accountID:"",inputAreaID:"",submitBtnID:"",categoryAreaID:"",fieldAreaID:"",field:"",categoryName:"",suggestAreaClass:"np-keyword-suggest",itemListClass:"np-item-suggest",maxSuggest:10,matchMode:"prefix",groupByCategory:false,alwaysOnTop:false,sortType:1,minimumChar:-1,overlayMode:"off",overlayPlaceHolder:"",furigana:true,suggestHighlight:"off",suggestAreaXcordinate:0,suggestAreaYcordinate:0,historyEnabled:"off",rankingEnabled:"off",rankingType:"daily",pathDisplayType:1,recommendItemEnabled:"off",recommendItemTiming:"mouseover",recommendItemAreaTitle:"Top Results",recommendItemAreaPosition:"right",recommendItemSort:"Score",recommendItemHtmlEnabled:false,recommendItemLimitWidth:-1,recommendItemLimitHeight:-1,recommendItemUrlPrefix:"",recommendImageUrlPrefix:"",recommendImageAlternative:"",sources:{search:{server:"",accountID:""},recommend:{server:"",accountID:""}},columns:{},_DUMMY_navi_command:0},initialize:function(options){this.keywordSuggestTaskTimer=new NPSuggest.Timer;this.itemRecommendTaskTimer=new NPSuggest.Timer;this.compositionTaskTimer=new NPSuggest.Timer;this.options={};this.sources={};this.columns={};this.version=1;for(name in this.defaultOptions){if(typeof options[name]!="undefined"){if(name=="sources"){this.version=2;for(name2 in this.defaultOptions.sources){this.sources[name2]=JSON.parse(JSON.stringify(this.defaultOptions.sources[name2]));if(typeof options.sources!="undefined"&&typeof options.sources[name2]!="undefined"){for(name3 in this.defaultOptions.sources[name2]){if(typeof options.sources[name2][name3]!="undefined"){this.sources[name2][name3]=options.sources[name2][name3]}}}}}else if(name=="columns"){this.version=2;this.columns=JSON.parse(JSON.stringify(options[name]));for(name in this.columns){var column=this.columns[name];if(typeof column!="undefined"){if(typeof column["upperSort"]=="undefined"){column.upperSort=this.options.recommendItemSort}if(typeof column["lowerSort"]=="undefined"){column.lowerSort=""}if(typeof column["recommendBase"]=="undefined"){column.recommendBase="keyword"}if(typeof column["recommendTmpl"]=="undefined"){column.recommendTmpl=0}}this.columns[name]=column}}else{this.options[name]=options[name]}}else{if(name=="sources"){this.sources=JSON.parse(JSON.stringify(this.defaultOptions[name]))}else if(name=="columns"){}else{this.options[name]=this.defaultOptions[name]}}}if(this.version==1&&typeof options["server"]!="undefined"){this.sources.search.server=options.server}if(this.version==1&&typeof options["accountID"]!="undefined"){this.sources.search.accountID=options.accountID}if(this.version>=2&&typeof options["itemListClass"]=="undefined"){this.options.itemListClass="np-item-suggest-v2"}this.request=new NPSuggest.Request(this.options,this.sources,this.columns,this.version);this.input=NPSuggest.Util.getElement(this.options.inputAreaID);if(typeof this.input=="undefined"||this.input==null){this.input=document.createElement("input")}this.suggestArea=document.createElement("div");this.suggestArea.className=this.options.suggestAreaClass;if(this._isOverlay()){var w=Math.max(document.body.clientWidth,document.body.scrollWidth,document.documentElement.scrollWidth,document.documentElement.clientWidth);this.suggestArea.style.width=w+"px";var h=Math.max(document.body.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.documentElement.clientHeight);this.suggestArea.style.height=h+"px";document.body.appendChild(this.suggestArea);this.suggestArea.className+=" "+this.options.suggestAreaClass+"_overlay"}else if(this.options.alwaysOnTop==true||this.options.alwaysOnTop=="on"){document.body.appendChild(this.suggestArea)}else{if(this.input.parentNode){this.input.parentNode.appendChild(this.suggestArea)}}this.itemListArea=document.createElement("div");this.itemListArea.className=this.options.itemListClass;if(this.options.alwaysOnTop==true||this.options.alwaysOnTop=="on"){document.body.appendChild(this.itemListArea)}else{if(this.input.parentNode){this.input.parentNode.appendChild(this.itemListArea)}}this.categoryArea=NPSuggest.Util.getElement(this.options.categoryAreaID);if(typeof this.categoryArea=="undefined"||this.categoryArea==null)this.categoryArea=document.createElement("input");this.fieldArea=NPSuggest.Util.getElement(this.options.fieldAreaID);if(typeof this.fieldArea=="undefined"||this.fieldArea==null)this.field=this.options.field;this.candidateList=null;this.oldText=this.getInputText();this.oldCategory=this.getInputCategory();this.oldField=this.getInputField();this.groupByField=false;this.arole=-1;this.compositionStatus=false;this.keywordBackup="";if(this._isOverlay()){NPSuggest.Event.add(this.input,"focus",this._bind(this.createOverlayArea,this.request.overlay_multi_flag));NPSuggest.Event.add(window,"beforeunload",this._bind(this.clearOverlayArea,true,false))}else{NPSuggest.Event.add(this.input,"focus",this._bind(this.checkLoop));NPSuggest.Event.add(this.input,"blur",this._bind(this.inputBlur));var keyevent=NPSuggest.Util.getKeyEvent();NPSuggest.Event.add(this.input,keyevent,this._bindEvent(this.keyEvent));NPSuggest.Event.add(this.input,"compositionstart",this._bindEvent(this.compositionStartEvent));NPSuggest.Event.add(this.input,"compositionend",this._bindEvent(this.compositionEndEvent));NPSuggest.Event.add(window,"resize",this._bind(this._onWindowResize,true))}var submitBtn=NPSuggest.Util.getElement(this.options.submitBtnID);if(typeof submitBtn=="undefined"||submitBtn==null){submitBtn=document.createElement("input")}NPSuggest.Event.add(submitBtn,"click",this._bind(this.keywordLogger,this.options.inputAreaID));if(this.options.historyEnabled==="on"){var history_key="__sna_h1story_"+this.options.accountID;NPSuggest.Event.add(submitBtn,"click",this._bind(NPSuggest.Util.registSearchHistory,history_key,"",this.options.historyEnabled,this.options.inputAreaID))}this.clearSuggestArea(true)},keywordLogger:function(inputAreaID){if((this.arole==4||this.arole==-1)&&inputAreaID!=null){var input=document.getElementById(inputAreaID);var keyword=input?input.value:"";var category=this.getInputCategory();if(keyword.length!=0){this.request.search.sendRequest("keywordlogger",{q:keyword,category:category})}}},createKeywordList:function(text,category,field){this.candidateList=[];this.request.search.createSuggestKeywordList(text,category,field,this._bind(this.setCandidateList,text))},setCandidateList:function(text){this.candidateList=this.request.search.getCandidateKeywordList(text);var info=this.request.search.getResultInfo(text);if(typeof info.group_by_field!="undefined"){this.groupByField=info.group_by_field}if(typeof info.arole!="undefined"&&this.arole==-1){this.arole=info.arole}},createItemList:function(index){if(this.options.recommendItemEnabled==false||this.options.recommendItemEnabled==="off"){return}var categoryName=this.options.categoryName;var category=this.getInputCategory();if(this.activePosition===index){this.clearRecommendItemArea();var element=this.suggestList[index];var keyword=NPSuggest.Util.getSuggestValue(element,"value");var fieldName="";if(element&&"field"in element){fieldName=element.field}this.request.search.createSuggestItemList(keyword,categoryName,category,fieldName,this._bind(this.createRecommendItemArea,keyword,category),"upper")}else if(index<0){if(this.resultList.length<=0){this.clearRecommendItemArea(true);return}this.clearRecommendItemArea();var element=this.suggestList[0];var keyword=NPSuggest.Util.getSuggestValue(element,"value");var fieldName="";if("field"in element){fieldName=element.field}this.request.search.createSuggestItemList(keyword,categoryName,category,fieldName,this._bind(this.createRecommendItemArea,keyword,category),"upper")}},createRecommendItemArea:function(keyword,category){if(this._isOverlay()){return}var fieldName="";if(this.options.recommendItemTiming=="input"&&this.activePosition==null){if(this.suggestList=="undefined"||this.suggestList==null||this.suggestList.length<=0){return}var element=this.suggestList[0];var k=NPSuggest.Util.getSuggestValue(element,"value");if(keyword!=k){return}if(element&&"field"in element){fieldName=element.field}}else{if(this.activePosition==null){return}var element=this.suggestList[this.activePosition];var k=NPSuggest.Util.getSuggestValue(element,"value");if(keyword!=k){return}if(element&&"field"in element){fieldName=element.field}}var column=null;if(typeof this.columns[fieldName]!="undefined"){column=this.columns[fieldName]}if(this.version>=2&&column!=null){var html=this.request.search.getSuggestItemList(keyword,category,fieldName,"html");if(typeof html=="string"&&html!=null){if(typeof NPSuggest_createItemList_html=="function"){var contents2=NPSuggest_createItemList_html(keyword,fieldName,html,this.options,this.request,column);if(typeof contents2=="string"){this.itemListArea.innerHTML=contents2}else{for(var i=this.itemListArea.childNodes.length-1;i>=0;i--){this.itemListArea.removeChild(this.itemListArea.childNodes[i])}this.itemListArea.appendChild(contents2)}}else{this.itemListArea.innerHTML=html}if(this._isItemAreaEnabled()){this.itemListArea.style.display="block"}}else{this.clearRecommendItemArea(true)}}else{var items=this.request.search.getSuggestItemList(keyword,category,fieldName);var info=this.request.search.getSuggestItemInfo(keyword,category,fieldName);if(items.length>0){if(typeof NPSuggest_createItemList=="function"){var contents=NPSuggest_createItemList(items,this.options.recommendItemAreaTitle,this.options,info);if(typeof contents=="string"){this.itemListArea.innerHTML=contents}else{for(var i=this.itemListArea.childNodes.length-1;i>=0;i--){this.itemListArea.removeChild(this.itemListArea.childNodes[i])}this.itemListArea.appendChild(contents)}if(this._isItemAreaEnabled()){this.itemListArea.style.display="block"}}}else{this.clearRecommendItemArea(true)}}},clearRecommendItemArea:function(forceClear){if(forceClear==true||this.options.recommendItemTiming!="input"){this.itemListArea.innerHTML="";this.itemListArea.style.display="none"}},inputBlur:function(){this.changeUnactive();this.oldText=this.getInputText();this.keywordSuggestTaskTimer.set(this._bind(this.clearSuggestArea,true),500)},checkLoop:function(){if(this.options.maxSuggest<=0){return}var text=this.getInputText();var category=this.getInputCategory();var field=this.getInputField();if(text.length==0){if(this.options.historyEnabled=="on"&&this.options.rankingEnabled=="on"){var text="###his_rank"}else if(this.options.historyEnabled=="on"){var text="###his"}else if(this.options.rankingEnabled=="on"){var text="###rank"}if(category!=this.oldCategory){this.oldCategory=category;this.request.search.clearHistoryAndRankingData(text)}this.createKeywordList(text,category,"")}if(text!=this.oldText||category!=this.oldCategory||field!=this.oldField){this.oldText=text;this.oldCategory=category;this.oldField=field;this.createKeywordList(text,category,field);if(this.candidateList!=null&&this.candidateList.length>0){this.search();if(this.options.recommendItemTiming=="input"&&!this._isOverlay()){this.itemRecommendTaskTimer.set(this._bind(this.createItemList,-1),300)}}else{if(this._isOverlay()){this.clearOverlayArea(false,false)}else{this.clearSuggestArea(true)}}}else if(this.candidateList!=null&&this.candidateList.length>0&&this.resultList==null){this.search();if(this.options.recommendItemTiming=="input"&&!this._isOverlay()){this.itemRecommendTaskTimer.set(this._bind(this.createItemList,-1),300)}}this.keywordSuggestTaskTimer.set(this._bind(this.checkLoop),this.interval)},search:function(){if(this._isOverlay()){this.clearOverlayArea(false,false)}else{this.clearSuggestArea()}this._search();if(this.resultList!=null&&this.resultList.length>0){this.createSuggestArea()}},_matchesKana:function(candidate,list){for(var i=0;i<list.length;i++){if(candidate.indexOf(list[i])!==-1){return true}}return false},_search:function(){var resultList;if(this.groupByField){var resultListByField={};var fieldIndex=0;for(var i=0,length=this.candidateList.length;i<length;i++){var candidate=this.candidateList[i];var field=candidate.field;if(field==null){field=""}var fl=resultListByField[field];if(fl==null){fl={index:fieldIndex,list:[]};resultListByField[field]=fl;fieldIndex++}else if(fl.list.length>=this.options.maxSuggest){continue}var duplicate=false;for(var ii=0;ii<fl.list.length;ii++){if(fl.list[ii].surface==candidate.surface){duplicate=true;break}}if(!duplicate){fl.list.push(candidate)}}resultList=new Array(fieldIndex);for(var name in resultListByField){var fl=resultListByField[name];resultList[fl.index]={field:name,list:fl.list}}}else{var itemCount=0;var resultListByCategory={};var categoryIndex=0;for(var i=0,length=this.candidateList.length;i<length&&itemCount<this.options.maxSuggest;i++){var candidate=this.candidateList[i];var categories=null;if((this.options.groupByCategory==true||this.options.groupByCategory=="on")&&candidate.category){categories=candidate.category}else{categories=[""]}for(var ci=0;ci<categories.length&&itemCount<this.options.maxSuggest;ci++){var category=categories[ci];if(category==null){category=""}var cat=resultListByCategory[category];if(cat==null){cat={index:categoryIndex,list:[]};resultListByCategory[category]=cat;categoryIndex++}var duplicate=false;for(var ii=0;ii<cat.list.length;ii++){if(cat.list[ii].surface==candidate.surface){duplicate=true;break}}if(!duplicate){cat.list.push(candidate);itemCount++}}}resultList=new Array(categoryIndex);for(var name in resultListByCategory){var cat=resultListByCategory[name];resultList[cat.index]={category:name,list:cat.list}}}this.resultList=resultList},clearSuggestArea:function(forceClear){if(this._isOverlay()){this.clearOverlayArea(true,false);return}this.suggestArea.innerHTML="";this.suggestArea.style.display="none";this.suggestList=null;this.activePosition=null;this.resultList=null;this.clearRecommendItemArea(forceClear)},createOverlayArea:function(overlay_multi_flag){var inputAlreadyExists=false;var inputAreaId="__NPSuggest_text_input";var tmpTextAreaId="__NPSuggest_text_input_input";for(i=0;i<this.suggestArea.childNodes.length;i++){var element=this.suggestArea.childNodes[i];if(element.id==inputAreaId||element.id==inputAreaId+"_"+this.options.inputAreaID){inputAlreadyExists=true;break}}var inputArea,spanArea,tmpTextArea,clearButton,submitButton,cancelButton;if(!inputAlreadyExists){inputArea=document.createElement("div");inputArea.id=overlay_multi_flag?inputAreaId+"_"+this.options.inputAreaID:inputAreaId;inputArea.className="inputArea";cancelButton=document.createElement("button");cancelButton.innerText="cancel";cancelButton.className="cancelButton";NPSuggest.Event.add(cancelButton,"click",this._bind(this.clearOverlayArea,true,true));inputArea.appendChild(cancelButton);submitButton=document.createElement("button");submitButton.innerText="submit";submitButton.className="submitButton";NPSuggest.Event.add(submitButton,"click",this._bind(this.listClick));inputArea.appendChild(submitButton);spanArea=document.createElement("span");spanArea.style.display="inline-block";spanArea.style.position="relative";tmpTextArea=document.createElement("input");tmpTextArea.type="text";tmpTextArea.autoComplete="off";tmpTextArea.id=overlay_multi_flag?tmpTextAreaId+"_"+this.options.inputAreaID:tmpTextAreaId;tmpTextArea.placeholder=this.options.overlayPlaceHolder;spanArea.appendChild(tmpTextArea);clearButton=document.createElement("a");clearButton.innerHTML="&#10006;";clearButton.style.textDecoration="none";clearButton.style.top="1px";clearButton.style.position="absolute";clearButton.style.right="6px";clearButton.style.top="1px";spanArea.appendChild(clearButton);inputArea.appendChild(spanArea);NPSuggest.Event.add(clearButton,"click",this._bind(function(){tmpTextArea.value=""}));this.suggestArea.appendChild(inputArea);NPSuggest.Event.add(tmpTextArea,"focus",this._bind(this.checkLoop));var keyevent=NPSuggest.Util.getKeyEvent();NPSuggest.Event.add(tmpTextArea,keyevent,this._bindEvent(this.keyEvent));NPSuggest.Event.add(tmpTextArea,"compositionstart",this._bindEvent(this.compositionStartEvent));NPSuggest.Event.add(tmpTextArea,"compositionend",this._bindEvent(this.compositionEndEvent))}else{window.scrollTo(0,0)}this.suggestArea.style.position="absolute";this.suggestArea.style.zIndex=2147483647;this.suggestArea.style.left=0;this.suggestArea.style.top=0;this.suggestArea.style.display="block";this.oldText=null;this.oldCategory=null;this.oldField=null;this.keywordBackup="";if(!inputAlreadyExists){var w_div=NPSuggest.Util.getCurrentWidth(inputArea);var w_submit=NPSuggest.Util.getCurrentWidth(submitButton,true);var w_cancel=NPSuggest.Util.getCurrentWidth(cancelButton,true);var w_input=w_div-(w_submit+w_cancel);if(w_input>0){tmpTextArea.style.width=String(w_input)+"px"}if(document.defaultView){cs=document.defaultView.getComputedStyle(tmpTextArea,null);clearButton.style.fontSize=cs.fontSize}else if(element.currentStyle){clearButton.style.fontSize=tmpTextArea.currentStyle.fontSize}}var textAreaID=overlay_multi_flag?tmpTextAreaId+"_"+this.options.inputAreaID:tmpTextAreaId;this.input=NPSuggest.Util.getElement(textAreaID);var inp=NPSuggest.Util.getElement(this.options.inputAreaID);if(typeof inp!="undefined"){this.input.value=inp.value}this.input.focus()},clearOverlayArea:function(hideArea,takeOver_flag){var ol_textArea_value="";for(i=0;i<this.suggestArea.childNodes.length;i++){var element=this.suggestArea.childNodes[i];if(element.id.indexOf("__NPSuggest_text_input")!=0){this.suggestArea.removeChild(element);i--}else{if(typeof element.childNodes[2]!="undefined"){if(typeof element.childNodes[2].childNodes[0]!="undefined"){var tmp_ol_textArea=NPSuggest.Util.getElement(element.childNodes[2].childNodes[0].id);if(tmp_ol_textArea&&tmp_ol_textArea.id.indexOf("__NPSuggest_text_input")==0){ol_textArea_value=tmp_ol_textArea.value}}}}}this.suggestList=null;this.activePosition=null;this.resultList=null;this.clearRecommendItemArea(true);if(hideArea){this.suggestArea.style.display="none";if(takeOver_flag){var inp=NPSuggest.Util.getElement(this.options.inputAreaID);inp.value=ol_textArea_value}}},createSuggestArea:function(){this.suggestList=[];this.inputValueBackup=this.getInputText();var lastCategory=null;if(this.groupByField){for(var flIndex=0,length=this.resultList.length;flIndex<length;flIndex++){var fl=this.resultList[flIndex];var group_element=document.createElement("div");group_element.className="group";group_element.className+=" "+this.options.suggestAreaClass+"-group-"+fl.field;for(var i=0;i<fl.list.length;i++){var keyword=fl.list[i];var element;var fieldName=fl.field;var display_str=keyword.surface;var search_val=keyword.surface;var rank=i+1;if(fieldName=="path"&&display_str.indexOf(":")!=-1){var buf=display_str.split(":");buf.reverse();search_val=buf.join(":");if(this.options.pathDisplayType==1){display_str=buf.pop();if(buf.length>0){display_str+=" - ";display_str+=buf.join(" > ");
}}else{display_str=buf.join(" > ")}}if(this.options._DUMMY_navi_command>0){display_str="["+keyword.sort_value+"] "+display_str}if(this.options.suggestHighlight==true||this.options.suggestHighlight=="on"){element=NPSuggest.Util.highlightHTML(display_str,this.getInputText(),"highlight",fieldName,rank)}else{element=NPSuggest.Util.highlightHTML(display_str,this.getInputText(),"",fieldName,rank)}element.value=search_val;element.field=fieldName;element.className="item "+fieldName;var plusBtn=null;if(this._isOverlay()){plusBtn=document.createElement("button");plusBtn.innerHTML="＋";plusBtn.className="plusButton";element.appendChild(plusBtn)}if(fieldName=="history"){var clearHistoryBtn=null;clearHistoryBtn=document.createElement("button");clearHistoryBtn.innerHTML="x";clearHistoryBtn.className="clearHistory";clearHistoryBtn.setAttribute("type","button");element.appendChild(clearHistoryBtn)}group_element.appendChild(element);var listIndex=this.suggestList.length;NPSuggest.Event.add(element,"click",this._bindEvent(this.listClick,listIndex));NPSuggest.Event.add(element,"mouseover",this._bindEvent(this.listMouseOver,listIndex));NPSuggest.Event.add(element,"mouseout",this._bindEvent(this.listMouseOut,listIndex));if(plusBtn!=null){NPSuggest.Event.add(plusBtn,"click",this._bindEvent(this.listClick2,listIndex))}if(clearHistoryBtn!=null){NPSuggest.Event.add(clearHistoryBtn,"click",this._bindEvent(this.clickClearHistory,listIndex));clearHistoryBtn=null}this.suggestList.push(element)}this.suggestArea.appendChild(group_element)}}else{for(var catIndex=0,length=this.resultList.length;catIndex<length;catIndex++){var cat=this.resultList[catIndex];if(this.options.groupByCategory==true||this.options.groupByCategory=="on"){if(cat.category!=lastCategory){lastCategory=cat.category;var element=document.createElement("div");if(cat.category=="undefined"||cat.category.length==0){element.innerHTML="&nbsp;"}else{element.innerHTML=NPSuggest.Util.escapeHTML(cat.category)}element.className="category";this.suggestArea.appendChild(element);var listIndex=this.suggestList.length;NPSuggest.Event.add(element,"click",this._bindEvent(this.listClick,listIndex));NPSuggest.Event.add(element,"mouseover",this._bindEvent(this.listMouseOver,listIndex));NPSuggest.Event.add(element,"mouseout",this._bindEvent(this.listMouseOut,listIndex));this.suggestList.push(element)}}for(var i=0;i<cat.list.length;i++){var keyword=cat.list[i];var element;var display_str=keyword.surface;var search_val=keyword.surface;if(keyword.field=="path"&&display_str.indexOf(":")!=-1){var buf=display_str.split(":");buf.reverse();search_val=buf.join(":");if(this.options.pathDisplayType==1){display_str=buf.pop();if(buf.length>0){display_str+=" - ";display_str+=buf.join(" > ")}}else{display_str=buf.join(" > ")}}if(this.options._DUMMY_navi_command>0){display_str="["+keyword.sort_value+"] "+display_str}if(this.options.suggestHighlight==true||this.options.suggestHighlight=="on"){element=NPSuggest.Util.highlightHTML(display_str,this.getInputText(),"highlight","","")}else{element=NPSuggest.Util.highlightHTML(display_str,this.getInputText(),"","","")}element.value=search_val;element.className="item";var plusBtn=null;if(this._isOverlay()){plusBtn=document.createElement("button");plusBtn.innerHTML="＋";plusBtn.className="plusButton";element.appendChild(plusBtn)}this.suggestArea.appendChild(element);var listIndex=this.suggestList.length;NPSuggest.Event.add(element,"click",this._bindEvent(this.listClick,listIndex));NPSuggest.Event.add(element,"mouseover",this._bindEvent(this.listMouseOver,listIndex));NPSuggest.Event.add(element,"mouseout",this._bindEvent(this.listMouseOut,listIndex));if(plusBtn!=null){NPSuggest.Event.add(plusBtn,"click",this._bindEvent(this.listClick2,listIndex))}this.suggestList.push(element)}}}this.drawSuggestArea()},drawSuggestArea:function(){var pos=this._onWindowResize();if(!this._isOverlay()){this.suggestArea.style.position="absolute";this.suggestArea.style.zIndex=2147483647;this.suggestArea.style.height="auto";this.suggestArea.style.display="block";this.clearRecommendItemArea();this.itemListArea.style.position="absolute";this.itemListArea.style.zIndex=2147483647;this.itemListArea.style.height="auto"}this._onWindowResize2(pos)},getInputText:function(){return this.input.value},getInputCategory:function(){return this.categoryArea.value},getInputField:function(){return this.fieldArea?this.fieldArea.value:this.field},setInputText:function(text){this.input.value=text},keyEvent:function(event){if(!this.keywordSuggestTaskTimer.hasTask()){this.keywordSuggestTaskTimer.set(this._bind(this.checkLoop),this.interval)}if(event.keyCode==NPSuggest.Key.UP||event.keyCode==NPSuggest.Key.DOWN){if(this.suggestList&&this.suggestList.length!=0){NPSuggest.Event.stop(event);this.keyEventMove(event.keyCode)}}else if(event.keyCode==NPSuggest.Key.RETURN){if(this._isOverlay()){this.keyEventReturn(event)}else{if(this.activePosition==null){}else if(this.suggestList&&this.suggestList.length!=0){this.keyEventReturn(event)}}}else if(event.keyCode==NPSuggest.Key.ESC){if(this._isOverlay()){NPSuggest.Event.stop(event);this.keyEventEsc()}else{if(this.activePosition==null){}else if(this.suggestList&&this.suggestList.length!=0){NPSuggest.Event.stop(event);this.keyEventEsc()}}}else{this.keyEventOther(event)}},keyEventMove:function(keyCode){this.changeUnactive();if(keyCode==NPSuggest.Key.UP){if(this.activePosition==null){this.activePosition=this.suggestList.length-1}else{this.activePosition--}var element=this.suggestList[this.activePosition];while(!NPSuggest.Util.isVisible(element)){this.activePosition--;if(this.activePosition<0){this.activePosition=null;this.input.value=this.inputValueBackup;return}element=this.suggestList[this.activePosition]}}else{if(this.activePosition==null){this.activePosition=0}else{this.activePosition++}var element=this.suggestList[this.activePosition];while(!NPSuggest.Util.isVisible(element)){this.activePosition++;if(this.activePosition>=this.suggestList.length){this.activePosition=null;this.input.value=this.inputValueBackup;return}element=this.suggestList[this.activePosition]}}this.changeActive(this.activePosition)},keyEventReturn:function(event){var categoryName=this.options.categoryName;var category=this.getInputCategory();var element,keyword;var index=this.activePosition;if(this.suggestList!=null&&this.suggestList.length>0&&typeof this.suggestList[index]!="undefined"){element=this.suggestList[index];keyword=NPSuggest.Util.getSuggestValue(element,"value");if(keyword==null){keyword=""}}else{keyword=this.getInputText()}var fieldName="";if(element&&"field"in element){fieldName=element.field}var fireSubmit=false;if(this._isOverlay()){var inp=NPSuggest.Util.getElement(this.options.inputAreaID);if(inp){inp.value=this.getInputText();keyword=inp.value}}var history_key="__sna_h1story_"+this.options.accountID;NPSuggest.Util.registSearchHistory(history_key,keyword,this.options.historyEnabled,null);if(typeof NPSuggest_listClick=="function"){if(this._isOverlay()){this.clearOverlayArea(true,false)}NPSuggest.Event.stop(event);if(index!=null){if(NPSuggest_listClick(keyword,fieldName,categoryName,category)==true){return}else{fireSubmit=true}}else{fireSubmit=true}}this.clearSuggestArea();this.moveEnd();var submit=NPSuggest.Util.getElement(this.options.submitBtnID);if(this._isOverlay()){var inp=NPSuggest.Util.getElement(this.options.inputAreaID);if(inp){inp.value=this.getInputText()}if(submit){if(submit.click){submit.click()}else if(submit.onclick){submit.onclick()}}}else if(fireSubmit){if(submit){if(submit.click){submit.click()}else if(submit.onclick){submit.onclick()}}}},keyEventEsc:function(){this.clearSuggestArea();this.input.value=this.inputValueBackup;if(this._isOverlay()){}else{this.oldText=this.getInputText()}if(window.opera)setTimeout(this._bind(this.moveEnd),5)},keyEventOther:function(event){},compositionStartEvent:function(event){this.compositionStatus=true},compositionEndEvent:function(event){this.compositionStatus=false;if(NPSuggest.Browser.MobileSafari&&this.keywordBackup.length>0){this.setInputText("");this.compositionTaskTimer.set(this._bind(this.compositionDelayEvent),50)}},compositionDelayEvent:function(){this.setInputText(this.keywordBackup);this.keywordBackup=""},changeActive:function(index){if(index==null||typeof index=="undefined"){return}var element=this.suggestList[index];this.setStyleActive(element);var keyword=NPSuggest.Util.getSuggestValue(element,"value");this.setInputText(keyword);if(this.compositionStatus){this.keywordBackup=keyword}this.oldText=this.getInputText();this.input.focus();this.itemRecommendTaskTimer.set(this._bind(this.createItemList,index),200)},changeUnactive:function(){if(this.suggestList!=null&&this.suggestList.length>0&&this.activePosition!=null){this.setStyleUnactive(this.suggestList[this.activePosition])}},listClick:function(event,index){this.changeUnactive();this.activePosition=index;this.changeActive(index);this.moveEnd();var categoryName=this.options.categoryName;var category=this.getInputCategory();var element,keyword;if(this.suggestList!=null&&this.suggestList.length>0&&typeof this.suggestList[index]!="undefined"){element=this.suggestList[index];keyword=NPSuggest.Util.getSuggestValue(element,"value");if(keyword==null){keyword=""}}else{keyword=this.getInputText()}var fieldName="";if(element&&"field"in element){fieldName=element.field}if(this._isOverlay()){var inp=NPSuggest.Util.getElement(this.options.inputAreaID);if(inp){inp.value=this.getInputText();keyword=inp.value}}var history_key="__sna_h1story_"+this.options.accountID;NPSuggest.Util.registSearchHistory(history_key,keyword,this.options.historyEnabled,null);if(typeof NPSuggest_listClick=="function"){if(this._isOverlay()){this.clearOverlayArea(true,false)}if(index!=undefined){if(NPSuggest_listClick(keyword,fieldName,categoryName,category)==true){return}}}var submit=NPSuggest.Util.getElement(this.options.submitBtnID);if(typeof submit=="undefined"||submit==null){if(this._isOverlay()){this.clearOverlayArea(true,false)}}else if(submit.click){submit.click()}else if(submit.onclick){submit.onclick()}},listClick2:function(event,index){this.changeUnactive();this.activePosition=index;this.changeActive(index);this.moveEnd();NPSuggest.Event.stop(event);this.oldText=""},clickClearHistory:function(event,index){this.changeUnactive();this.activePosition=index;var element=this.suggestList[index];var keyword=NPSuggest.Util.getSuggestValue(element,"value");var history_key="__sna_h1story_"+this.options.accountID;NPSuggest.Util.clearSearchHistory(history_key,keyword);element.parentNode.removeChild(element);this.setInputText("");if(this._isOverlay()){this.clearOverlayArea(false,false)}else{this.clearSuggestArea(true)}NPSuggest.Event.stop(event);document.getElementById(this.input.id).focus();this.keywordSuggestTaskTimer.set(this._bind(this.checkLoop),1)},listMouseOver:function(event,index){this.changeUnactive();this.activePosition=index;var el=NPSuggest.Event.getElement(event);if(el.isHighlight==true){el=el.parentNode}this.setStyleActive(el);if(!this._isOverlay()){this.itemRecommendTaskTimer.set(this._bind(this.createItemList,index),300)}},listMouseOut:function(event,index){this.itemRecommendTaskTimer.clear();if(!this.suggestList)return;var el=NPSuggest.Event.getElement(event);if(el.isHighlight==true){el=el.parentNode}if(index==this.activePosition){this.setStyleActive(el)}else{this.setStyleUnactive(el)}},addClass:function(element,className){if(!element||!("className"in element)){return}var name=element.className;if(name!=null&&name.length>0){var names=name.split(" ");for(var i=0;i<names.length;i++){if(names[i]==className){return}}element.className=name+" "+className}else{element.className=className}},removeClass:function(element,className){if(!element||!("className"in element)){return}var name=element.className;if(name!=null&&name.length>0){var names=name.split(" ");var newNames=[];for(var i=0;i<names.length;i++){if(names[i]!=className){newNames.push(names[i])}}element.className=newNames.join(" ")}},setStyleActive:function(element){this.addClass(element,"selected")},setStyleUnactive:function(element){this.removeClass(element,"selected")},moveEnd:function(){if(this.input.createTextRange){this.input.focus();var range=this.input.createTextRange();range.move("character",this.input.value.length);range.select()}else if(this.input.setSelectionRange){this.input.setSelectionRange(this.input.value.length,this.input.value.length)}},_bind:function(func){var self=this;var args=Array.prototype.slice.call(arguments,1);return function(){func.apply(self,args)}},_bindEvent:function(func){var self=this;var args=Array.prototype.slice.call(arguments,1);return function(event){event=event||window.event;func.apply(self,[event].concat(args))}},_isItemAreaEnabled:function(){if(this.options.recommendItemEnabled==true||this.options.recommendItemEnabled=="on"){return true}else if(this.options.recommendItemEnabled==false||this.options.recommendItemEnabled=="off"){return false}else if(this.options.recommendItemEnabled=="auto"){if(this._isOverlay()){return false}var limitWidth=this.options.recommendItemLimitWidth;var limitHeight=this.options.recommendItemLimitHeight;var w;var h;if((!document.all||window.opera)&&document.getElementById){w=window.innerWidth;h=window.innerHeight}else if(document.getElementById&&document.compatMode=="CSS1Compat"){w=document.documentElement.clientWidth;h=document.documentElement.clientHeight}else if(document.all){w=document.body.clientWidth;h=document.body.clientHeight}else{w=Math.max(document.body.clientWidth,document.body.scrollWidth,document.documentElement.scrollWidth,document.documentElement.clientWidth);h=Math.max(document.body.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.documentElement.clientHeight)}if(limitWidth>w||limitHeight>h){return false}}return true},_onWindowResize:function(isChain){var x=0;var y=0;if(this._isOverlay()){}else if(this.options.alwaysOnTop==true||this.options.alwaysOnTop=="on"){this.inputPos=NPSuggest.Util.getAbsolutePosition(this.input);var height=NPSuggest.Util.getCurrentHeight(this.input);x=this.inputPos.x;y=this.inputPos.y+height;if((navigator.platform=="iPhone"||navigator.platform=="iPod")&&navigator.userAgent.search(/iPhone OS (2|3|4)_/)>0){y+=15}}else{var iPos=NPSuggest.Util.getElementPosition(this.input);x=iPos.x;y=iPos.y+this.input.offsetHeight;if((navigator.platform=="iPhone"||navigator.platform=="iPod")&&navigator.userAgent.search(/iPhone OS (2|3|4)_/)>0){y+=15}}if(this._isOverlay()){var xPos=String(x)+"px";var yPos=String(y)+"px"}else{var xPos=String(x+parseInt(this.options.suggestAreaXcordinate,10))+"px";var yPos=String(y+parseInt(this.options.suggestAreaYcordinate,10))+"px"}this.suggestArea.style.left=xPos;this.suggestArea.style.top=yPos;var pos=new Array(x,y);if(isChain){this._onWindowResize2(pos)}return pos},_onWindowResize2:function(pos){if(this._isOverlay()){return}if(this._isItemAreaEnabled()&&this.itemListArea.innerHTML.length>0){this.itemListArea.style.display="block"}else{this.itemListArea.style.display="none"}var x=pos[0];var y=pos[1];var xPos=String(x+parseInt(this.options.suggestAreaXcordinate,10))+"px";var yPos=String(y+parseInt(this.options.suggestAreaYcordinate,10))+"px";if(this.options.recommendItemAreaPosition=="right"){xPos=String(x+this.suggestArea.offsetWidth+parseInt(this.options.suggestAreaXcordinate,10))+"px";this.itemListArea.style.left=xPos;this.itemListArea.style.top=yPos}else if(this.options.recommendItemAreaPosition=="left"){xPos=String(x-NPSuggest.Util.getCurrentWidth(this.itemListArea)+parseInt(this.options.suggestAreaXcordinate,10))+"px";this.itemListArea.style.left=xPos;this.itemListArea.style.top=yPos}else{yPos=String(y+this.suggestArea.offsetHeight+parseInt(this.options.suggestAreaYcordinate,10))+"px";this.itemListArea.style.left=xPos;this.itemListArea.style.top=yPos}},_isOverlay:function(){if(this.options.overlayMode=="auto"){return NPSuggest.Browser.isMobile()}else if(this.options.overlayMode==true||this.options.overlayMode=="on"){return true}else if(!this.options.overlayMode==false||this.options.overlayMode=="off"){return false}return false}};NPSuggest.Key={TAB:9,RETURN:13,ESC:27,UP:38,DOWN:40};NPSuggest.Util={addCSSRule:function(css,selector,attribute,value){if(css.addRule){css.addRule(selector,attribute+":"+value)}else if(css.insertRule){css.insertRule(selector+"{"+attribute+":"+value+"}",css.cssRules.length)}},normalizeKeyword:function(keyword){var str=new String;var len=keyword.length;for(var i=0;i<len;i++){var c=keyword.charCodeAt(i);if(c>=12353&&c<=12435||c==12445||c==12446)str+=String.fromCharCode(c+96);else if(c>=65313&&c<=65338||c>=65345&&c<=65370||c>=65296&&c<=65305||c==65343)str+=String.fromCharCode(c-65248);else if(c==12288)str+=String.fromCharCode(32);else str+=keyword.charAt(i)}return str.toLowerCase()},escapeHTML:function(value){return value.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;")},highlightHTML:function(value,str,cls,fieldName,rank){var doc=document.createElement("div");if(fieldName=="ranking"&&rank!=""){var span_element=document.createElement("span");span_element.className="snva-ranking-"+rank;span_element.textContent=rank+". ";doc.appendChild(span_element)}if(fieldName=="history"&&rank!=""){var span_element=document.createElement("span");span_element.className="snva-history-"+rank;doc.appendChild(span_element)}var str=str.toString();if(!cls||str.length==0){doc.appendChild(document.createTextNode(value))}else{var pos=value.indexOf(str);if(pos<0){doc.appendChild(document.createTextNode(value))}else{var before,highlight,after;before=document.createTextNode(value.substr(0,pos));highlight=document.createElement("div");highlight.appendChild(document.createTextNode(str));highlight.className=cls;highlight.isHighlight=true;after=document.createTextNode(value.substr(pos+str.length));doc.appendChild(before);doc.appendChild(highlight);doc.appendChild(after)}}return doc},textContent:function(element){return element.textContent||element.innerText},getSuggestValue:function(element,name){if(!element){return null}if(name in element){return element[name]}return NPSuggest.Util.textContent(element)},getElement:function(element){if(typeof element=="string"){if(element.length>0){return document.getElementById(element)}return null}return element},getElementPosition:function(element){if(!NPSuggest.Browser.IE&&!NPSuggest.Browser.Opera)return this._getElementPositionMozilla(element);var x=0;var y=0;var parent=element;while(parent){if(parent!=element&&document.defaultView&&document.defaultView.getComputedStyle(parent,null).position=="relative")break;if(parent!=element&&parent.currentStyle&&parent.currentStyle["position"]=="relative")break;if(parent!=element&&document.defaultView&&document.defaultView.getComputedStyle(parent,null).position=="absolute")break;if(parent!=element&&parent.currentStyle&&parent.currentStyle["position"]=="absolute")break;var borderXOffset=0;var borderYOffset=0;if(parent!=element){borderXOffset=parseInt(parent.style.borderLeftWidth,10);borderYOffset=parseInt(parent.style.borderTopWidth,10);borderXOffset=isNaN(borderXOffset)?0:borderXOffset;borderYOffset=isNaN(borderYOffset)?0:borderYOffset}if(parent==element&&parent.scrollLeft>parent.width){x+=parent.offsetLeft-parent.width+borderXOffset}else{if(parent!=document.body&&parent!=document.documentElement){x+=parent.offsetLeft-parent.scrollLeft+borderXOffset}else{x+=parent.offsetLeft+borderXOffset}}if(parent!=document.body&&parent!=document.documentElement){y+=parent.offsetTop-parent.scrollTop+borderYOffset}else{y+=parent.offsetTop+borderYOffset}parent=parent.offsetParent}return{x:x,y:y}},_getElementPositionMozilla:function(element){var x=0;var y=0;var parent=element;while(parent){if(parent!=element&&document.defaultView&&document.defaultView.getComputedStyle(parent,null).position=="relative")break;if(parent!=element&&document.defaultView&&document.defaultView.getComputedStyle(parent,null).position=="absolute"){if(NPSuggest.Browser.Firefox&&NPSuggest.Browser.getVersion()<=9&&parent.tagName=="TABLE"){}else{break}}x+=parent.offsetLeft;y+=parent.offsetTop;parent=parent.offsetParent}parent=element;while(parent&&parent!=document.body&&parent!=document.documentElement){if(parent.scrollLeft&&parent!=element)x-=parent.scrollLeft;if(parent.scrollTop)y-=parent.scrollTop;parent=parent.parentNode}return{x:x,y:y}},getAbsolutePosition:function(element){var x=window.pageXOffset!==undefined?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft;var y=window.pageYOffset!==undefined?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;var bounds=element.getBoundingClientRect();x=Math.round(x+bounds.left);y=Math.round(y+bounds.top);return{x:x,y:y}},getCurrentHeight:function(element,withMargin){var height=0;var cs;if(document.defaultView){cs=document.defaultView.getComputedStyle(element,null);height=parseInt(cs.height)+parseInt(cs.paddingTop)+parseInt(cs.paddingBottom)+parseInt(cs.borderTopWidth)+parseInt(cs.borderBottomWidth);if(withMargin==true){height+=parseInt(cs.marginTop)+parseInt(cs.marginBottom)}}else if(element.currentStyle){height=element.offsetHeight}return height},getCurrentWidth:function(element,withMargin){var width=0;var cs;if(document.defaultView){cs=document.defaultView.getComputedStyle(element,null);width=parseInt(cs.width)+parseInt(cs.paddingLeft)+parseInt(cs.paddingRight)+parseInt(cs.borderLeftWidth)+parseInt(cs.borderRightWidth);if(withMargin==true){width+=parseInt(cs.marginLeft)+parseInt(cs.marginRight)}}else if(element.currentStyle){width=element.offsetWidth}return width},getAllSelectors:function(){var ret=[];for(var i=0;i<document.styleSheets.length;i++){var rules=[];try{rules=document.styleSheets[i].rules||document.styleSheets[i].cssRules}catch(e){if(e.name!=="SecurityError"){throw e}continue}for(var x in rules){if(typeof rules[x].selectorText=="string")ret.push(rules[x].selectorText)}}return ret},selectorExists:function(selector){var selectors=NPSuggest.Util.getAllSelectors();for(var i=0;i<selectors.length;i++){if(selectors[i]==selector)return true}return false},isVisible:function(element){if(element=="undefined"||element==null){return null}var cs;if(document.defaultView){cs=document.defaultView.getComputedStyle(element,null)}else if(element.currentStyle){cs=element.currentStyle}if(cs.display=="none"){return false}else if(cs.visibility=="hidden"||cs.visibility=="collapse"){return false}else if(parseInt(cs.height)<=0){return false}return true},getKeyEvent:function(){var keyevent="keydown";if(window.opera){keyevent="keypress"}else if(navigator.userAgent.indexOf("Gecko")>=0){if(navigator.userAgent.indexOf("KHTML")==-1&&navigator.userAgent.indexOf("Trident")==-1){keyevent="keypress"}}return keyevent},registSearchHistory:function(key,val,use_history_flag,inputId){if(use_history_flag!=="on"){return}if(val.length==0){if(inputId!=null){var input=document.getElementById(inputId);if(input){val=input.value}}}if(val.length==0){return}var keep_history_limit=10;var delimiter="__";var search_history=NPSuggest.Util.compatibleStoreGetDecoded(key);if(search_history){var arr_search_history=search_history.split(delimiter);var arr_tmp=[];for(var l=0;l<arr_search_history.length;l++){if(val!==arr_search_history[l]){arr_tmp.push(arr_search_history[l])}}var res=arr_tmp;if(res.length==0){NPSuggest.store.set(key,encodeURIComponent(val))}else{while(res.length>=keep_history_limit){res.pop()}res.unshift(val);val=res.join(delimiter);NPSuggest.store.set(key,encodeURIComponent(val))}}else{NPSuggest.store.set(key,encodeURIComponent(val))}},clearSearchHistory:function(key,val){var search_history=NPSuggest.Util.compatibleStoreGetDecoded(key);var delimiter="__";var arr_search_history=search_history.split(delimiter);var arr_tmp=[];for(var l=0;l<arr_search_history.length;l++){if(val!==arr_search_history[l]){arr_tmp.push(arr_search_history[l])}}var res=arr_tmp;if(res.length==0){NPSuggest.store.remove(key)}else if(res.length==1){val=res.toString();NPSuggest.store.set(key,encodeURIComponent(val))}else{val=res.join(delimiter);NPSuggest.store.set(key,encodeURIComponent(val))}},fetchUid:function(){var uidKey1="__bvr_s1d";var uidKey2="__sna_s1d";var uid1=NPSuggest.Util.getCookie(uidKey1);var uid2=NPSuggest.Util.getCookie(uidKey2);var uid=NPSuggest.Util.randomString(30);if(typeof uid1!="undefined"&&uid1!=""){uid=uid1}else if(typeof uid2!="undefined"&&uid2!=""){uid=uid2}var expires=new Date;expires.setFullYear(expires.getFullYear()+5);var opt={expires:expires,path:"/"};if(typeof uid1=="undefined"||uid1==""){NPSuggest.Util.addCookie(uidKey1,uid,opt)}if(typeof uid2=="undefined"||uid2==""){NPSuggest.Util.addCookie(uidKey2,uid,opt)}return uid},addCookie:function(key,val,options){if(typeof options==="undefined"){options={}}document.cookie=NPSuggest.Util.generateCookieString(key,val,options)},getCookie:function(key){return NPSuggest.Util.getCookies()[key]},getCookies:function(){strArr=document.cookie.split(";");var ret={};for(var i=0;i<strArr.length;i++){var x=strArr[i];var pair=x.split("=");pair[0]=pair[0].replace(/^\s+|\s+$/,"");try{ret[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}catch(e){}}return ret},generateCookieString:function(key,val,options){key=key.replace(/[^#$&+\^`|]/g,encodeURIComponent);key=key.replace(/\(/g,"%28").replace(/\)/g,"%29");val=(val+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent);var xs=[key+"="+val];if(options.path){xs.push("path="+options.path)}if(options.domain){xs.push("domain="+encodeURIComponent(options.domain))}if(options.secure){xs.push("secure")}if(options.expires){var dateExpires=options.expires;try{if(dateExpires&&!isNaN(dateExpires.getTime())){xs.push("expires="+dateExpires.toUTCString())}}catch(e){}}return xs.join(";")},randomString:function(n){var a="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";a=a.split("");var s="";if(window.Uint8Array&&window.crypto&&window.crypto.getRandomValues){var values=new Uint8Array(n);window.crypto.getRandomValues(values);for(var i=0;i<n;i++){s+=a[values[i]%a.length]}}else{for(var i=0;i<n;i++){s+=a[Math.floor(Math.random()*a.length)]}}return s},compatibleStoreGetDecoded:function(key){var rawString=NPSuggest.store.get(key);if(!rawString){return""}try{var str=decodeURIComponent(rawString);if(rawString!=str||encodeURIComponent(str)==rawString){return str}}catch(e){}var oldRawString=NPSuggest.oldStoreJS.get(key);if(!oldRawString){return""}try{str=decodeURIComponent(oldRawString);NPSuggest.store.set(key,oldRawString);return str}catch(e){return""}}};NPSuggest.bind=function(options){if(document.readyState==="loading"||document.readyState==="interactive"){NPSuggest.Event.add(window,"load",function(){new NPSuggest.Controller(options)})}else{new NPSuggest.Controller(options)}};NPSuggest.Browser={IE:!!(window.attachEvent&&navigator.userAgent.indexOf("Opera")===-1),IE6:!!(window.attachEvent&&navigator.userAgent.indexOf("Opera")===-1)&&typeof document.documentElement.style.maxHeight=="undefined",Opera:navigator.userAgent.indexOf("Opera")>-1,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")===-1,Firefox:navigator.userAgent.indexOf("Firefox")>-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/),getVersion:function(){if(NPSuggest.Browser.IE){return parseFloat(navigator.appVersion.toLowerCase().replace(/.*msie[ ]?/,"").match(/^[0-9]+[.]?[0-9]?/))}if(NPSuggest.Browser.Firefox){return parseFloat(navigator.userAgent.toLowerCase().replace(/.*firefox\/[ ]?/,"").match(/^[0-9]+[.]?[0-9]?/))}return 0},isMobile:function(){var a=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))){return true}return false}};NPSuggest.KanaRomaConverter={kana1:["キャ","キィ","キュ","キェ","キョ","ギャ","ギィ","ギュ","ギェ","ギョ","クァ","クィ","クゥ","クェ","クォ","グァ","グィ","グゥ","グェ","グォ","シャ","シャ","シュ","シュ","シェ","シェ","ショ","ショ","ジャ","ジィ","ジュ","ジェ","ジョ","チャ","チィ","チュ","チェ","チョ","ヂャ","ヂィ","ヂュ","ヂェ","ヂョ","トァ","トィ","トゥ","トェ","トォ","ニャ","ニィ","ニュ","ニェ","ニョ","ヴァ","ヴィ","ヴェ","ヴォ","ヒャ","ヒィ","ヒュ","ヒェ","ヒョ","ファ","フィ","フェ","フォ","フャ","フュ","フョ","ビャ","ビィ","ビュ","ビェ","ビョ","ヴャ","ヴィ","ヴュ","ヴェ","ヴョ","ピャ","ピィ","ピュ","ピェ","ピョ","ミャ","ミィ","ミュ","ミェ","ミョ","リャ","リィ","リュ","リェ","リョ","ウィ","ウェ","イェ"],roma1:["kya","kyi","kyu","kye","kyo","gya","gyi","gyu","gye","gyo","qwa","qwi","qwu","qwe","qwo","gwa","gwi","gwu","gwe","gwo","sya","sha","syu","shu","sye","she","syo","sho","ja","jyi","ju","je","jo","cha","cyi","chu","che","cho","dya","dyi","dyu","dye","dyo","twa","twi","twu","twe","two","nya","nyi","nyu","nye","nyo","va","vi","ve","vo","hya","hyi","hyu","hye","hyo","fa","fi","fe","fo","fya","fyu","fyo","bya","byi","byu","bye","byo","vya","vyi","vyu","vye","vyo","pya","pyi","pyu","pye","pyo","mya","myi","myu","mye","myo","rya","ryi","ryu","rye","ryo","wi","we","ye"],kana2:["シャ","シュ","シェ","ショ","カ","キ","ク","ケ","コ","タ","チ","チ","ツ","ツ","テ","ト","サ","シ","シ","ス","セ","ソ","ナ","ニ","ヌ","ネ","ノ","ハ","ヒ","フ","フ","ヘ","ホ","マ","ミ","ム","メ","モ","ヤ","ユ","ヨ","ラ","リ","ル","レ","ロ","ワ","ヰ","ヱ","ヲ","ン","ガ","ギ","グ","ゲ","ゴ","ザ","ジ","ズ","ゼ","ゾ","ダ","ヂ","ヅ","デ","ド","バ","ビ","ブ","ベ","ボ","パ","ピ","プ","ペ","ポ","ア","イ","ウ","エ","オ"],roma2:["sya","syu","sye","syo","ka","ki","ku","ke","ko","ta","chi","ti","tsu","tu","te","to","sa","shi","si","su","se","so","na","ni","nu","ne","no","ha","hi","fu","hu","he","ho","ma","mi","mu","me","mo","ya","yu","yo","ra","ri","ru","re","ro","wa","wyi","wye","wo","n","ga","gi","gu","ge","go","za","ji","zu","ze","zo","da","ji","du","de","do","ba","bi","bu","be","bo","pa","pi","pu","pe","po","a","i","u","e","o"],init:function(){if(!this.initialized){var roma=this.roma1.concat(this.roma2);var sokuRoma=[];for(var i=0;i<this.roma2.length-5;i++){sokuRoma.push(this.roma2[i].substr(0,1)+this.roma2[i])}roma=sokuRoma.concat(roma);this.romaPattern=[];for(var i=0;i<roma.length;i++){this.romaPattern.push(new RegExp(roma[i],"g"))}var kana=this.kana1.concat(this.kana2);var sokuKana=[];for(var i=0;i<this.kana2.length-5;i++){
sokuKana.push("ッ"+this.kana2[i])}this.kanaReplacement=sokuKana.concat(kana);this.initialized=true}},_replaceEach:function(from,to,str){for(var i=0;i<from.length;i++){str=str.replace(from[i],to[i])}return str},romaToKanaExpandSuffix:function(str){return this.expandRomaSuffix(this.romaToKana(str))},romaToKana:function(str){this.init();str=this._replaceEach(this.romaPattern,this.kanaReplacement,str);str=str.replace(/([ァ-ヺ])-/g,"$1ー");return str},expandRomaSuffix:function(str){return this._expandRomaSuffix(str,[[this.roma2,this.kana2],[this.roma1,this.kana1]])},_expandRomaSuffix:function(str,pairs){var match=/(.*?)([a-z]{1,2})$/.exec(str);if(match){var result=[];var body=match[1];var suffix=match[2];for(var p=0;p<pairs.length;p++){var pair=pairs[p];var roma=pair[0];var kana=pair[1];for(var i=0;i<roma.length;i++){if(roma[i].indexOf(suffix)==0){var term=body+kana[i];var j=result.length-1;for(;j>=0;j--){if(result[j]==term)break}if(j<0)result.push(term)}}}if(result.length>0){if(body.length>0&&suffix.length==1)result.push(body+"ッ");return result}}return[str]}};NPSuggest.setupBeacon=function(server,account){"use strict";var baseUrl=(server?"//"+server:"")+"/~"+account+"/?action=beacon";document.addEventListener("click",clickHandler,true);function clickHandler(event){var e=event.target;while(e){if(e.hasAttribute("data-np-beacon")){return triggerBeacon(event,e)}e=e.parentElement}}function triggerBeacon(event,element){var k_uid=getUserIdFromUrlParams("k_uid")||searchAtrribute(element,"data-np-userid")||NPSuggest.Util.fetchUid();var params={k_uid:k_uid,itemid:searchAtrribute(element,"data-np-itemid"),result_index:searchAtrribute(element,"data-np-index"),group_index:searchAtrribute(element,"data-np-groupindex"),link_type:searchAtrribute(element,"data-np-linktype"),qid:searchAtrribute(element,"data-np-queryid"),querystring:searchAtrribute(element,"data-np-querystring"),page_url:location.href};var requestUrl=baseUrl;for(var key in params){var v=params[key];if(v){requestUrl+="&"+key+"="+encodeURIComponent(v)}}if(typeof navigator.sendBeacon==="function"&&navigator.sendBeacon(requestUrl,null)){return}var xhr=new XMLHttpRequest;xhr.open("POST",requestUrl,true);xhr.timeout=500;xhr.send()}function searchAtrribute(element,attributeName){var e=element;while(e){if(e.hasAttribute(attributeName)){return e.getAttribute(attributeName)}e=e.parentElement}return null}function getUserIdFromUrlParams(key){var search=window.location.search;if(search.length>0){var kvs=search.slice(1).split("&");for(var i=0;i<kvs.length;i++){var kv=kvs[i].split("=");if(kv[0]===key){return kv[1]}}}return null}};var originalStore=window.store;delete window.store;!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.store=t()}}(function(){var define,module,exports;return function t(e,n,r){function o(u,s){if(!n[u]){if(!e[u]){var a="function"==typeof require&&require;if(!s&&a)return a(u,!0);if(i)return i(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[u]={exports:{}};e[u][0].call(f.exports,function(t){var n=e[u][1][t];return o(n?n:t)},f,f.exports,t,e,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(t,e,n){"use strict";var r=t("../src/store-engine"),o=t("../storages/all"),i=t("../plugins/all");e.exports=r.createStore(o,i)},{"../plugins/all":2,"../src/store-engine":15,"../storages/all":17}],2:[function(t,e,n){"use strict";e.exports=[t("./compression"),t("./defaults"),t("./dump"),t("./events"),t("./observe"),t("./expire"),t("./json2"),t("./operations"),t("./update"),t("./v1-backcompat")]},{"./compression":3,"./defaults":4,"./dump":5,"./events":6,"./expire":7,"./json2":8,"./observe":11,"./operations":12,"./update":13,"./v1-backcompat":14}],3:[function(t,e,n){"use strict";function r(){function t(t,e){var n=t(e);if(!n)return n;var r=o.decompress(n);return null==r?n:this._deserialize(r)}function e(t,e,n){var r=o.compress(this._serialize(n));t(e,r)}return{get:t,set:e}}var o=t("./lib/lz-string");e.exports=r},{"./lib/lz-string":10}],4:[function(t,e,n){"use strict";function r(){function t(t,e){n=e}function e(t,e){var r=t();return void 0!==r?r:n[e]}var n={};return{defaults:t,get:e}}e.exports=r},{}],5:[function(t,e,n){"use strict";function r(){function t(t){var e={};return this.each(function(t,n){e[n]=t}),e}return{dump:t}}e.exports=r},{}],6:[function(t,e,n){"use strict";function r(){function t(t,e,n){return c.on(e,u(this,n))}function e(t,e){c.off(e)}function n(t,e,n){c.once(e,u(this,n))}function r(t,e,n){var r=this.get(e);t(),c.fire(e,n,r)}function i(t,e){var n=this.get(e);t(),c.fire(e,void 0,n)}function a(t){var e={};this.each(function(t,n){e[n]=t}),t(),s(e,function(t,e){c.fire(e,void 0,t)})}var c=o();return{watch:t,unwatch:e,once:n,set:r,remove:i,clearAll:a}}function o(){return a(f,{_id:0,_subSignals:{},_subCallbacks:{}})}var i=t("../src/util"),u=i.bind,s=i.each,a=i.create,c=i.slice;e.exports=r;var f={_id:null,_subCallbacks:null,_subSignals:null,on:function(t,e){return this._subCallbacks[t]||(this._subCallbacks[t]={}),this._id+=1,this._subCallbacks[t][this._id]=e,this._subSignals[this._id]=t,this._id},off:function(t){var e=this._subSignals[t];delete this._subCallbacks[e][t],delete this._subSignals[t]},once:function(t,e){var n=this.on(t,u(this,function(){e.apply(this,arguments),this.off(n)}))},fire:function(t){var e=c(arguments,1);s(this._subCallbacks[t],function(t){t.apply(this,e)})}}},{"../src/util":16}],7:[function(t,e,n){"use strict";function r(){function t(t,e,n,r){return this.hasNamespace(o)||s.set(e,r),t()}function e(t,e){return this.hasNamespace(o)||u.call(this,e),t()}function n(t,e){return this.hasNamespace(o)||s.remove(e),t()}function r(t,e){return s.get(e)}function i(t){var e=[];this.each(function(t,n){e.push(n)});for(var n=0;n<e.length;n++)u.call(this,e[n])}function u(t){var e=s.get(t,Number.MAX_VALUE);e<=(new Date).getTime()&&(this.raw.remove(t),s.remove(t))}var s=this.createStore(this.storage,null,this._namespacePrefix+o);return{set:t,get:e,remove:n,getExpiration:r,removeExpiredKeys:i}}var o="expire_mixin";e.exports=r},{}],8:[function(t,e,n){"use strict";function r(){return t("./lib/json2"),{}}e.exports=r},{"./lib/json2":9}],9:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};"object"!==("undefined"==typeof JSON?"undefined":_typeof(JSON))&&(JSON={}),function(){function f(t){return t<10?"0"+t:t}function this_value(){return this.valueOf()}function quote(t){return rx_escapable.lastIndex=0,rx_escapable.test(t)?'"'+t.replace(rx_escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var n,r,o,i,u,s=gap,a=e[t];switch(a&&"object"===("undefined"==typeof a?"undefined":_typeof(a))&&"function"==typeof a.toJSON&&(a=a.toJSON(t)),"function"==typeof rep&&(a=rep.call(e,t,a)),"undefined"==typeof a?"undefined":_typeof(a)){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";if(gap+=indent,u=[],"[object Array]"===Object.prototype.toString.apply(a)){for(i=a.length,n=0;n<i;n+=1)u[n]=str(n,a)||"null";return o=0===u.length?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+s+"]":"["+u.join(",")+"]",gap=s,o}if(rep&&"object"===("undefined"==typeof rep?"undefined":_typeof(rep)))for(i=rep.length,n=0;n<i;n+=1)"string"==typeof rep[n]&&(r=rep[n],o=str(r,a),o&&u.push(quote(r)+(gap?": ":":")+o));else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(o=str(r,a),o&&u.push(quote(r)+(gap?": ":":")+o));return o=0===u.length?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+s+"}":"{"+u.join(",")+"}",gap=s,o}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;r<n;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=e,e&&"function"!=typeof e&&("object"!==("undefined"==typeof e?"undefined":_typeof(e))||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var n,r,o=t[e];if(o&&"object"===("undefined"==typeof o?"undefined":_typeof(o)))for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(r=walk(o,n),void 0!==r?o[n]=r:delete o[n]);return reviver.call(t,e,o)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()},{}],10:[function(t,e,n){"use strict";var r=function(){function t(t,e){if(!o[t]){o[t]={};for(var n=0;n<t.length;n++)o[t][t.charAt(n)]=n}return o[t][e]}var e=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={},i={compressToBase64:function(t){if(null==t)return"";var e=i._compress(t,6,function(t){return n.charAt(t)});switch(e.length%4){default:case 0:return e;case 1:return e+"===";case 2:return e+"==";case 3:return e+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:i._decompress(e.length,32,function(r){return t(n,e.charAt(r))})},compressToUTF16:function(t){return null==t?"":i._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:i._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(t){for(var e=i.compress(t),n=new Uint8Array(2*e.length),r=0,o=e.length;r<o;r++){var u=e.charCodeAt(r);n[2*r]=u>>>8,n[2*r+1]=u%256}return n},decompressFromUint8Array:function(t){if(null===t||void 0===t)return i.decompress(t);for(var n=new Array(t.length/2),r=0,o=n.length;r<o;r++)n[r]=256*t[2*r]+t[2*r+1];var u=[];return n.forEach(function(t){u.push(e(t))}),i.decompress(u.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":i._compress(t,6,function(t){return r.charAt(t)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),i._decompress(e.length,32,function(n){return t(r,e.charAt(n))}))},compress:function(t){return i._compress(t,16,function(t){return e(t)})},_compress:function(t,e,n){if(null==t)return"";var r,o,i,u={},s={},a="",c="",f="",l=2,p=3,h=2,d=[],g=0,v=0;for(i=0;i<t.length;i+=1)if(a=t.charAt(i),Object.prototype.hasOwnProperty.call(u,a)||(u[a]=p++,s[a]=!0),c=f+a,Object.prototype.hasOwnProperty.call(u,c))f=c;else{if(Object.prototype.hasOwnProperty.call(s,f)){if(f.charCodeAt(0)<256){for(r=0;r<h;r++)g<<=1,v==e-1?(v=0,d.push(n(g)),g=0):v++;for(o=f.charCodeAt(0),r=0;r<8;r++)g=g<<1|1&o,v==e-1?(v=0,d.push(n(g)),g=0):v++,o>>=1}else{for(o=1,r=0;r<h;r++)g=g<<1|o,v==e-1?(v=0,d.push(n(g)),g=0):v++,o=0;for(o=f.charCodeAt(0),r=0;r<16;r++)g=g<<1|1&o,v==e-1?(v=0,d.push(n(g)),g=0):v++,o>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete s[f]}else for(o=u[f],r=0;r<h;r++)g=g<<1|1&o,v==e-1?(v=0,d.push(n(g)),g=0):v++,o>>=1;l--,0==l&&(l=Math.pow(2,h),h++),u[c]=p++,f=String(a)}if(""!==f){if(Object.prototype.hasOwnProperty.call(s,f)){if(f.charCodeAt(0)<256){for(r=0;r<h;r++)g<<=1,v==e-1?(v=0,d.push(n(g)),g=0):v++;for(o=f.charCodeAt(0),r=0;r<8;r++)g=g<<1|1&o,v==e-1?(v=0,d.push(n(g)),g=0):v++,o>>=1}else{for(o=1,r=0;r<h;r++)g=g<<1|o,v==e-1?(v=0,d.push(n(g)),g=0):v++,o=0;for(o=f.charCodeAt(0),r=0;r<16;r++)g=g<<1|1&o,v==e-1?(v=0,d.push(n(g)),g=0):v++,o>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete s[f]}else for(o=u[f],r=0;r<h;r++)g=g<<1|1&o,v==e-1?(v=0,d.push(n(g)),g=0):v++,o>>=1;l--,0==l&&(l=Math.pow(2,h),h++)}for(o=2,r=0;r<h;r++)g=g<<1|1&o,v==e-1?(v=0,d.push(n(g)),g=0):v++,o>>=1;for(;;){if(g<<=1,v==e-1){d.push(n(g));break}v++}return d.join("")},decompress:function(t){return null==t?"":""==t?null:i._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(t,n,r){var o,i,u,s,a,c,f,l,p=[],h=4,d=4,g=3,v="",m=[],y={val:r(0),position:n,index:1};for(i=0;i<3;i+=1)p[i]=i;for(s=0,c=Math.pow(2,2),f=1;f!=c;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*f,f<<=1;switch(o=s){case 0:for(s=0,c=Math.pow(2,8),f=1;f!=c;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*f,f<<=1;l=e(s);break;case 1:for(s=0,c=Math.pow(2,16),f=1;f!=c;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*f,f<<=1;l=e(s);break;case 2:return""}for(p[3]=l,u=l,m.push(l);;){if(y.index>t)return"";for(s=0,c=Math.pow(2,g),f=1;f!=c;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*f,f<<=1;switch(l=s){case 0:for(s=0,c=Math.pow(2,8),f=1;f!=c;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*f,f<<=1;p[d++]=e(s),l=d-1,h--;break;case 1:for(s=0,c=Math.pow(2,16),f=1;f!=c;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*f,f<<=1;p[d++]=e(s),l=d-1,h--;break;case 2:return m.join("")}if(0==h&&(h=Math.pow(2,g),g++),p[l])v=p[l];else{if(l!==d)return null;v=u+u.charAt(0)}m.push(v),p[d++]=u+v.charAt(0),h--,u=v,0==h&&(h=Math.pow(2,g),g++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return r}):"undefined"!=typeof e&&null!=e&&(e.exports=r)},{}],11:[function(t,e,n){"use strict";function r(){function t(t,e,n){var r=this.watch(e,n);return n(this.get(e)),r}function e(t,e){this.unwatch(e)}return{observe:t,unobserve:e}}var o=t("./events");e.exports=[o,r]},{"./events":6}],12:[function(t,e,n){"use strict";function r(){function t(t,e,n,r,o,i){return a.call(this,"push",arguments)}function e(t,e){return a.call(this,"pop",arguments)}function n(t,e){return a.call(this,"shift",arguments)}function r(t,e,n,r,o,i){return a.call(this,"unshift",arguments)}function i(t,e,n,r,i,a){var c=u(arguments,2);return this.update(e,{},function(t){if("object"!=("undefined"==typeof t?"undefined":o(t)))throw new Error('store.assign called for non-object value with key "'+e+'"');return c.unshift(t),s.apply(Object,c)})}function a(t,e){var n,r=e[1],o=u(e,2);return this.update(r,[],function(e){n=Array.prototype[t].apply(e,o)}),n}return{push:t,pop:e,shift:n,unshift:r,assign:i}}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=t("../src/util"),u=i.slice,s=i.assign,a=t("./update");e.exports=[a,r]},{"../src/util":16,"./update":13}],13:[function(t,e,n){"use strict";function r(){function t(t,e,n,r){3==arguments.length&&(r=n,n=void 0);var o=this.get(e,n),i=r(o);this.set(e,void 0!=i?i:o)}return{update:t}}e.exports=r},{}],14:[function(t,e,n){"use strict";function r(){return this.disabled=!this.enabled,{has:o,transact:i,clear:u,forEach:s,getAll:a,serialize:c,deserialize:f}}function o(t,e){return void 0!==this.get(e)}function i(t,e,n,r){null==r&&(r=n,n=null),null==n&&(n={});var o=this.get(e,n),i=r(o);this.set(e,void 0===i?o:i)}function u(t){return this.clearAll.call(this)}function s(t,e){return this.each.call(this,function(t,n){e(n,t)})}function a(t){return this.dump.call(this)}function c(t,e){return JSON.stringify(e)}function f(t,e){if("string"==typeof e)try{return JSON.parse(e)}catch(n){return e||void 0}}var l=t("./dump"),p=t("./json2");e.exports=[l,p,r]},{"./dump":5,"./json2":8}],15:[function(t,e,n){"use strict";function r(){var t="undefined"==typeof console?null:console;if(t){var e=t.warn?t.warn:t.log;e.apply(t,arguments)}}function o(t,e,n){n||(n=""),t&&!l(t)&&(t=[t]),e&&!l(e)&&(e=[e]);var o=n?"__storejs_"+n+"_":"",i=n?new RegExp("^"+o):null,g=/^[a-zA-Z0-9_\-]*$/;if(!g.test(n))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var v={_namespacePrefix:o,_namespaceRegexp:i,_testStorage:function(t){try{var e="__storejs__test__";t.write(e,e);var n=t.read(e)===e;return t.remove(e),n}catch(r){return!1}},_assignPluginFnProp:function(t,e){var n=this[e];this[e]=function(){function e(){if(n)return a(arguments,function(t,e){r[e]=t}),n.apply(o,r)}var r=u(arguments,0),o=this,i=[e].concat(r);return t.apply(o,i)}},_serialize:function(t){return JSON.stringify(t)},_deserialize:function(t,e){if(!t)return e;var n="";try{n=JSON.parse(t)}catch(r){n=t}return void 0!==n?n:e},_addStorage:function(t){this.enabled||this._testStorage(t)&&(this.storage=t,this.enabled=!0)},_addPlugin:function(t){var e=this;if(l(t))return void a(t,function(t){e._addPlugin(t)});var n=s(this.plugins,function(e){return t===e});if(!n){if(this.plugins.push(t),!p(t))throw new Error("Plugins must be function values that return objects");var r=t.call(this);if(!h(r))throw new Error("Plugins must return an object of function properties");a(r,function(n,r){if(!p(n))throw new Error("Bad plugin property: "+r+" from plugin "+t.name+". Plugins should only return functions.");e._assignPluginFnProp(n,r)})}},addStorage:function(t){r("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(t)}},m=f(v,d,{plugins:[]});return m.raw={},a(m,function(t,e){p(t)&&(m.raw[e]=c(m,t))}),a(t,function(t){m._addStorage(t)}),a(e,function(t){m._addPlugin(t)}),m}var i=t("./util"),u=i.slice,s=i.pluck,a=i.each,c=i.bind,f=i.create,l=i.isList,p=i.isFunction,h=i.isObject;e.exports={createStore:o};var d={version:"2.0.12",enabled:!1,get:function(t,e){var n=this.storage.read(this._namespacePrefix+t);return this._deserialize(n,e)},set:function(t,e){return void 0===e?this.remove(t):(this.storage.write(this._namespacePrefix+t,this._serialize(e)),e)},remove:function(t){this.storage.remove(this._namespacePrefix+t)},each:function(t){var e=this;this.storage.each(function(n,r){t.call(e,e._deserialize(n),(r||"").replace(e._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(t){return this._namespacePrefix=="__storejs_"+t+"_"},createStore:function(){return o.apply(this,arguments)},addPlugin:function(t){this._addPlugin(t)},namespace:function(t){return o(this.storage,this.plugins,t)}}},{"./util":16}],16:[function(t,e,n){(function(t){"use strict";function n(){return Object.assign?Object.assign:function(t,e,n,r){for(var o=1;o<arguments.length;o++)s(Object(arguments[o]),function(e,n){t[n]=e});return t}}function r(){if(Object.create)return function(t,e,n,r){var o=u(arguments,1);return h.apply(this,[Object.create(t)].concat(o))};var t=function(){};return function(e,n,r,o){var i=u(arguments,1);return t.prototype=e,h.apply(this,[new t].concat(i))}}function o(){return String.prototype.trim?function(t){return String.prototype.trim.call(t)}:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function i(t,e){return function(){return e.apply(t,Array.prototype.slice.call(arguments,0))}}function u(t,e){return Array.prototype.slice.call(t,e||0)}function s(t,e){c(t,function(t,n){return e(t,n),!1})}function a(t,e){var n=f(t)?[]:{};return c(t,function(t,r){return n[r]=e(t,r),!1}),n}function c(t,e){if(f(t)){for(var n=0;n<t.length;n++)if(e(t[n],n))return t[n]}else for(var r in t)if(t.hasOwnProperty(r)&&e(t[r],r))return t[r]}function f(t){return null!=t&&"function"!=typeof t&&"number"==typeof t.length}function l(t){return t&&"[object Function]"==={}.toString.call(t)}function p(t){return t&&"[object Object]"==={}.toString.call(t)}var h=n(),d=r(),g=o(),v="undefined"!=typeof window?window:t;e.exports={assign:h,create:d,trim:g,bind:i,slice:u,each:s,map:a,pluck:c,isList:f,isFunction:l,isObject:p,Global:v}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],17:[function(t,e,n){"use strict";e.exports=[t("./localStorage"),t("./oldFF-globalStorage"),t("./oldIE-userDataStorage"),t("./cookieStorage"),t("./sessionStorage"),t("./memoryStorage")]},{"./cookieStorage":18,"./localStorage":19,"./memoryStorage":20,"./oldFF-globalStorage":21,"./oldIE-userDataStorage":22,"./sessionStorage":23}],18:[function(t,e,n){"use strict";function r(t){if(!t||!a(t))return null;var e="(?:^|.*;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(p.cookie.replace(new RegExp(e),"$1"))}function o(t){for(var e=p.cookie.split(/; ?/g),n=e.length-1;n>=0;n--)if(l(e[n])){var r=e[n].split("="),o=unescape(r[0]),i=unescape(r[1]);t(i,o)}}function i(t,e){t&&(p.cookie=escape(t)+"="+escape(e)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function u(t){t&&a(t)&&(p.cookie=escape(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function s(){o(function(t,e){u(e)})}function a(t){return new RegExp("(?:^|;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(p.cookie)}var c=t("../src/util"),f=c.Global,l=c.trim;e.exports={name:"cookieStorage",read:r,write:i,each:o,remove:u,clearAll:s};var p=f.document},{"../src/util":16}],19:[function(t,e,n){"use strict";function r(){return f.localStorage}function o(t){return r().getItem(t)}function i(t,e){return r().setItem(t,e)}function u(t){for(var e=r().length-1;e>=0;e--){var n=r().key(e);t(o(n),n)}}function s(t){return r().removeItem(t)}function a(){return r().clear()}var c=t("../src/util"),f=c.Global;e.exports={name:"localStorage",read:o,write:i,each:u,remove:s,clearAll:a}},{"../src/util":16}],20:[function(t,e,n){"use strict";function r(t){return a[t]}function o(t,e){a[t]=e}function i(t){for(var e in a)a.hasOwnProperty(e)&&t(a[e],e)}function u(t){delete a[t]}function s(t){a={}}e.exports={name:"memoryStorage",read:r,write:o,each:i,remove:u,clearAll:s};var a={}},{}],21:[function(t,e,n){"use strict";function r(t){return f[t]}function o(t,e){f[t]=e}function i(t){for(var e=f.length-1;e>=0;e--){var n=f.key(e);t(f[n],n)}}function u(t){return f.removeItem(t)}function s(){i(function(t,e){delete f[t]})}var a=t("../src/util"),c=a.Global;e.exports={name:"oldFF-globalStorage",read:r,write:o,each:i,remove:u,clearAll:s};var f=c.globalStorage},{"../src/util":16}],22:[function(t,e,n){"use strict";function r(t,e){if(!g){var n=a(t);d(function(t){t.setAttribute(n,e),t.save(p)})}}function o(t){if(!g){var e=a(t),n=null;return d(function(t){n=t.getAttribute(e)}),n}}function i(t){d(function(e){for(var n=e.XMLDocument.documentElement.attributes,r=n.length-1;r>=0;r--){var o=n[r];t(e.getAttribute(o.name),o.name)}})}function u(t){var e=a(t);d(function(t){t.removeAttribute(e),t.save(p)})}function s(){d(function(t){var e=t.XMLDocument.documentElement.attributes;t.load(p);for(var n=e.length-1;n>=0;n--)t.removeAttribute(e[n].name);t.save(p)})}function a(t){return t.replace(/^\d/,"___$&").replace(v,"___")}function c(){if(!h||!h.documentElement||!h.documentElement.addBehavior)return null;var t,e,n,r="script";try{e=new ActiveXObject("htmlfile"),e.open(),e.write("<"+r+">document.w=window</"+r+'><iframe src="/favicon.ico"></iframe>'),e.close(),t=e.w.frames[0].document,n=t.createElement("div")}catch(o){n=h.createElement("div"),t=h.body}return function(e){var r=[].slice.call(arguments,0);r.unshift(n),t.appendChild(n),n.addBehavior("#default#userData"),n.load(p),e.apply(this,r),t.removeChild(n)}}var f=t("../src/util"),l=f.Global;e.exports={name:"oldIE-userDataStorage",write:r,read:o,each:i,remove:u,clearAll:s};var p="storejs",h=l.document,d=c(),g=(l.navigator?l.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./),v=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g")},{"../src/util":16}],23:[function(t,e,n){"use strict";function r(){return f.sessionStorage}function o(t){return r().getItem(t)}function i(t,e){return r().setItem(t,e)}function u(t){for(var e=r().length-1;e>=0;e--){var n=r().key(e);t(o(n),n)}}function s(t){return r().removeItem(t)}function a(){return r().clear()}var c=t("../src/util"),f=c.Global;e.exports={name:"sessionStorage",read:o,write:i,each:u,remove:s,clearAll:a}},{"../src/util":16}]},{},[1])(1)});NPSuggest.oldStoreJS=window.store;delete window.store;!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.store=e()}}(function(){return function e(t,n,r){function o(a,u){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[a]={exports:{}};t[a][0].call(f.exports,function(e){var n=t[a][1][e];return o(n?n:e)},f,f.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";var r=e("../src/store-engine"),o=[e("../storages/localStorage"),e("../storages/sessionStorage"),e("../storages/cookieStorage"),e("../storages/memoryStorage")],i=[];t.exports=r.createStore(o,i)},{"../src/store-engine":2,"../storages/cookieStorage":4,"../storages/localStorage":5,"../storages/memoryStorage":6,"../storages/sessionStorage":7}],2:[function(e,t,n){"use strict";function r(){var e="undefined"==typeof console?null:console;if(e){var t=e.warn?e.warn:e.log;t.apply(e,arguments)}}function o(e,t,n){n||(n=""),e&&!l(e)&&(e=[e]),t&&!l(t)&&(t=[t]);var o=n?"__storejs_"+n+"_":"",i=n?new RegExp("^"+o):null,h=/^[a-zA-Z0-9_\-]*$/;if(!h.test(n))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var v={_namespacePrefix:o,_namespaceRegexp:i,_testStorage:function(e){try{var t="__storejs__test__";e.write(t,t);var n=e.read(t)===t;return e.remove(t),n}catch(r){return!1}},_assignPluginFnProp:function(e,t){var n=this[t];this[t]=function(){function t(){if(n)return s(arguments,function(e,t){r[t]=e}),n.apply(o,r)}var r=a(arguments,0),o=this,i=[t].concat(r);return e.apply(o,i)}},_serialize:function(e){return JSON.stringify(e)},_deserialize:function(e,t){if(!e)return t;var n="";try{n=JSON.parse(e)}catch(r){n=e}return void 0!==n?n:t},_addStorage:function(e){this.enabled||this._testStorage(e)&&(this.storage=e,this.enabled=!0)},_addPlugin:function(e){var t=this;if(l(e))return void s(e,function(e){t._addPlugin(e)});var n=u(this.plugins,function(t){return e===t});if(!n){if(this.plugins.push(e),!p(e))throw new Error("Plugins must be function values that return objects");var r=e.call(this);if(!g(r))throw new Error("Plugins must return an object of function properties");s(r,function(n,r){if(!p(n))throw new Error("Bad plugin property: "+r+" from plugin "+e.name+". Plugins should only return functions.");t._assignPluginFnProp(n,r)})}},addStorage:function(e){r("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(e)}},m=f(v,d,{plugins:[]});return m.raw={},s(m,function(e,t){p(e)&&(m.raw[t]=c(m,e))}),s(e,function(e){m._addStorage(e)}),s(t,function(e){m._addPlugin(e)}),m}var i=e("./util"),a=i.slice,u=i.pluck,s=i.each,c=i.bind,f=i.create,l=i.isList,p=i.isFunction,g=i.isObject;t.exports={createStore:o};var d={version:"2.0.12",enabled:!1,get:function(e,t){var n=this.storage.read(this._namespacePrefix+e);return this._deserialize(n,t)},set:function(e,t){return void 0===t?this.remove(e):(this.storage.write(this._namespacePrefix+e,this._serialize(t)),t)},remove:function(e){this.storage.remove(this._namespacePrefix+e)},each:function(e){var t=this;this.storage.each(function(n,r){e.call(t,t._deserialize(n),(r||"").replace(t._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(e){return this._namespacePrefix=="__storejs_"+e+"_"},createStore:function(){return o.apply(this,arguments)},addPlugin:function(e){this._addPlugin(e)},namespace:function(e){return o(this.storage,this.plugins,e)}}},{"./util":3}],3:[function(e,t,n){(function(e){"use strict";function n(){return Object.assign?Object.assign:function(e,t,n,r){for(var o=1;o<arguments.length;o++)u(Object(arguments[o]),function(t,n){e[n]=t});return e}}function r(){if(Object.create)return function(e,t,n,r){var o=a(arguments,1);return g.apply(this,[Object.create(e)].concat(o))};var e=function(){};return function(t,n,r,o){var i=a(arguments,1);return e.prototype=t,g.apply(this,[new e].concat(i))}}function o(){return String.prototype.trim?function(e){return String.prototype.trim.call(e)}:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function i(e,t){return function(){return t.apply(e,Array.prototype.slice.call(arguments,0))}}function a(e,t){return Array.prototype.slice.call(e,t||0)}function u(e,t){c(e,function(e,n){return t(e,n),!1})}function s(e,t){var n=f(e)?[]:{};return c(e,function(e,r){return n[r]=t(e,r),!1}),n}function c(e,t){if(f(e)){for(var n=0;n<e.length;n++)if(t(e[n],n))return e[n]}else for(var r in e)if(e.hasOwnProperty(r)&&t(e[r],r))return e[r]}function f(e){return null!=e&&"function"!=typeof e&&"number"==typeof e.length}function l(e){return e&&"[object Function]"==={}.toString.call(e)}function p(e){return e&&"[object Object]"==={}.toString.call(e)}var g=n(),d=r(),h=o(),v="undefined"!=typeof window?window:e;t.exports={assign:g,create:d,trim:h,bind:i,slice:a,each:u,map:s,pluck:c,isList:f,isFunction:l,isObject:p,Global:v}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(e,t,n){"use strict";function r(e){if(!e||!s(e))return null;var t="(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(p.cookie.replace(new RegExp(t),"$1"))}function o(e){for(var t=p.cookie.split(/; ?/g),n=t.length-1;n>=0;n--)if(l(t[n])){var r=t[n].split("="),o=unescape(r[0]),i=unescape(r[1]);e(i,o)}}function i(e,t){e&&(p.cookie=escape(e)+"="+escape(t)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function a(e){e&&s(e)&&(p.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function u(){o(function(e,t){a(t)})}function s(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(p.cookie)}var c=e("../src/util"),f=c.Global,l=c.trim;t.exports={name:"cookieStorage",read:r,write:i,each:o,remove:a,clearAll:u};var p=f.document},{"../src/util":3}],5:[function(e,t,n){"use strict";function r(){return f.localStorage}function o(e){return r().getItem(e)}function i(e,t){return r().setItem(e,t)}function a(e){for(var t=r().length-1;t>=0;t--){var n=r().key(t);e(o(n),n)}}function u(e){return r().removeItem(e)}function s(){return r().clear()}var c=e("../src/util"),f=c.Global;t.exports={name:"localStorage",read:o,write:i,each:a,remove:u,clearAll:s}},{"../src/util":3}],6:[function(e,t,n){"use strict";function r(e){return s[e]}function o(e,t){s[e]=t}function i(e){
for(var t in s)s.hasOwnProperty(t)&&e(s[t],t)}function a(e){delete s[e]}function u(e){s={}}t.exports={name:"memoryStorage",read:r,write:o,each:i,remove:a,clearAll:u};var s={}},{}],7:[function(e,t,n){"use strict";function r(){return f.sessionStorage}function o(e){return r().getItem(e)}function i(e,t){return r().setItem(e,t)}function a(e){for(var t=r().length-1;t>=0;t--){var n=r().key(t);e(o(n),n)}}function u(e){return r().removeItem(e)}function s(){return r().clear()}var c=e("../src/util"),f=c.Global;t.exports={name:"sessionStorage",read:o,write:i,each:a,remove:u,clearAll:s}},{"../src/util":3}]},{},[1])(1)});NPSuggest.store=window.store;window.store=originalStore;
